<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADU Construction Progress Dashboard</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 { color: #333; margin-top: 0; }
        .loading { text-align: center; padding: 40px; color: #667eea; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label { font-size: 0.9em; color: #666; }
        .stat-value { font-size: 2em; font-weight: bold; color: #667eea; margin: 10px 0; }
        
        .toggle-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        button.active {
            background: #667eea;
            color: white;
        }
        
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .category {
            padding: 15px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border: 2px solid #667eea30;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #667eea25 0%, #764ba225 100%);
        }
        
        .category.checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .cumulative-total {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            font-size: 1.2em;
        }
        
        .cumulative-total.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è ADU Construction Progress</h1>
        <p>Danh Le's ADU Project Dashboard</p>
        
        <div id="content">
            <div class="loading">Loading...</div>
        </div>
    </div>
    
    <div class="cumulative-total" id="cumulativeTotal">
        <div>Selected Total: <strong id="totalAmount">$0</strong></div>
    </div>

    <script>
        // Fallback data
        const fallbackData = {
            payments: [
                { num: 1, title: "Initial Deposit & Site Mobilization", planned: 21800, actual: 21800 },
                { num: 2, title: "Foundation & Under-Slab Inspection", planned: 26000, actual: 47800 },
                { num: 3, title: "Rough MEP Inspection", planned: 34100, actual: 47800 },
                { num: 4, title: "Framing Inspection / Dry-In", planned: 28000, actual: 47800 },
                { num: 5, title: "Insulation & Drywall Inspections", planned: 59000, actual: 47800 },
                { num: 6, title: "Final Inspection & Project Completion + OH&P", planned: 56300, actual: 47800 }
            ],
            expenses: [
                { category: "Phase 0: Soft Costs", phase: "0", task: "Permit Fees", cost: 5306.43 },
                { category: "Phase 0: Soft Costs", phase: "0", task: "City Application Fee", cost: 650.13 },
                { category: "Phase 0: Soft Costs", phase: "0", task: "Architect and Engineering", cost: 8000.00 },
                { category: "Phase 1: Site Mobilization", phase: "1", task: "Porta Potty", cost: 2100.00 },
                { category: "Phase 1: Site Mobilization", phase: "1", task: "Trash Fee", cost: 2600.00 },
                { category: "Phase 1: Site Mobilization", phase: "1", task: "Demo", cost: 4500.00 },
                { category: "Phase 1: Site Mobilization", phase: "1", task: "Clearing and Grubbing", cost: 2100.00 },
                { category: "Phase 1: Site Mobilization", phase: "1", task: "Excavation and Grading", cost: 2500.00 },
                { category: "Phase 2: Foundation", phase: "2", task: "Footings", cost: 26000.00 },
                { category: "Phase 3: Rough MEP", phase: "3", task: "Rough plumbing, gas, and electrical", cost: 9500.00 },
                { category: "Phase 3: Rough MEP", phase: "3", task: "HVAC & Mechanical", cost: 7400.00 },
                { category: "Phase 3: Rough MEP", phase: "3", task: "Plumbing", cost: 5200.00 },
                { category: "Phase 3: Rough MEP", phase: "3", task: "Electrical", cost: 12000.00 },
                { category: "Phase 4: Framing", phase: "4", task: "Framing", cost: 28000.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Roofing", cost: 17000.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Doors and Windows", cost: 11500.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Exterior Stucco", cost: 12000.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Exterior Stairs", cost: 3000.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Insulation", cost: 4000.00 },
                { category: "Phase 5: Exterior", phase: "5", task: "Drywall", cost: 11500.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Interior Painting", cost: 4400.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Flooring", cost: 6576.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "ADU Kitchen", cost: 5500.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "ADU Bathroom 1", cost: 9500.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Powder Room", cost: 5800.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Lighting", cost: 4500.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Baseboards", cost: 2700.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Door Trim", cost: 2600.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Paving", cost: 2500.00 },
                { category: "Phase 6: Final Completion", phase: "6", task: "Deputy Inspection", cost: 1500.00 }
            ]
        };

        let viewMode = 'expand';
        let selectedPhases = new Set();
        let categoryData = {};

        function renderDashboard(data) {
            const totalBudget = 225200;
            const paidExpenses = data.expenses.filter(e => e.phase === "1" || e.phase === "2");
            const totalSpent = paidExpenses.reduce((sum, e) => sum + e.cost, 0);
            const remaining = totalBudget - totalSpent;
            const progressPercent = Math.round((totalSpent / totalBudget) * 100);

            // Build category map
            categoryData = {};
            data.expenses.forEach(exp => {
                if (!categoryData[exp.category]) {
                    categoryData[exp.category] = { total: 0, items: [], phase: exp.phase };
                }
                categoryData[exp.category].total += exp.cost;
                categoryData[exp.category].items.push(exp);
            });

            let html = `
                <div class="stats">
                    <div class="stat">
                        <div class="stat-label">Total Budget</div>
                        <div class="stat-value">$225k</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Amount Spent</div>
                        <div class="stat-value">$${(totalSpent/1000).toFixed(1)}k</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Remaining</div>
                        <div class="stat-value">$${(remaining/1000).toFixed(0)}k</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Progress</div>
                        <div class="stat-value">${progressPercent}%</div>
                    </div>
                </div>

                <div class="toggle-buttons">
                    <button class="active" onclick="switchMode('expand')">üëÅÔ∏è Expand Mode</button>
                    <button onclick="switchMode('cumulative')">‚òëÔ∏è Cumulative Mode</button>
                </div>

                <h3>Expense Breakdown by Phase</h3>
                <div class="categories" id="categories">
            `;

            // Sort and render categories
            Object.entries(categoryData)
                .sort((a, b) => parseInt(a[1].phase) - parseInt(b[1].phase))
                .forEach(([cat, data]) => {
                    html += `
                        <div class="category" data-category="${cat}" data-cost="${data.total}">
                            <strong>${cat}</strong><br>
                            $${data.total.toLocaleString(undefined, {maximumFractionDigits: 0})}
                        </div>
                    `;
                });

            html += '</div>';

            document.getElementById('content').innerHTML = html;

            // Add event listeners
            document.querySelectorAll('.category').forEach(el => {
                el.addEventListener('click', function() {
                    const cat = this.getAttribute('data-category');
                    if (viewMode === 'expand') {
                        alert(`${cat}\n\nItems:\n${categoryData[cat].items.map(i => `‚Ä¢ ${i.task}: $${i.cost.toLocaleString()}`).join('\n')}\n\nTotal: $${categoryData[cat].total.toLocaleString()}`);
                    } else {
                        this.classList.toggle('checked');
                        if (this.classList.contains('checked')) {
                            selectedPhases.add(cat);
                        } else {
                            selectedPhases.delete(cat);
                        }
                        updateCumulativeTotal();
                    }
                });
            });
        }

        function switchMode(mode) {
            viewMode = mode;
            selectedPhases.clear();
            document.querySelectorAll('.category').forEach(el => el.classList.remove('checked'));
            updateCumulativeTotal();
        }

        function updateCumulativeTotal() {
            const total = Array.from(selectedPhases).reduce((sum, cat) => sum + categoryData[cat].total, 0);
            const totalEl = document.getElementById('cumulativeTotal');
            const amountEl = document.getElementById('totalAmount');
            
            if (viewMode === 'cumulative' && selectedPhases.size > 0) {
                amountEl.textContent = `$${total.toLocaleString()}`;
                totalEl.classList.add('show');
            } else {
                totalEl.classList.remove('show');
            }
        }

        // Load on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                renderDashboard(fallbackData);
            }, 50);
        });
    </script>
</body>
</html>
